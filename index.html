<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>特殊兒資源導航 - 親子天下 Premium</title>
    
    <!-- 1. Tailwind CSS (樣式庫) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Babel (讓瀏覽器看得懂 React JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* 隱藏滾動條但保留功能 */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .mask-linear-fade {
            -webkit-mask-image: linear-gradient(to right, black 90%, transparent 100%);
            mask-image: linear-gradient(to right, black 90%, transparent 100%);
        }
        /* 載入動畫樣式 */
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-[#020617]">
    <div id="root"></div>

    <!-- 3. React 應用程式邏輯 -->
    <!-- 注意：這裡使用 type="text/babel" 和 data-type="module" 來支援現代化導入 -->
    <script type="text/babel" data-type="module">
        // 使用 esm.sh 引入 React 和 Lucide 圖示庫，這是最穩定的 CDN 方式
        import React, { useState, useEffect } from 'https://esm.sh/react@18.2.0?dev';
        import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client?dev';
        import { Search, Lock, Star, MapPin, ChevronRight, User, Menu, Activity, BookOpen, Shield, X, Headphones, Download } from 'https://esm.sh/lucide-react@0.263.1?dev';

        // 設定 Google Sheet CSV 網址
        const dataUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSutadj2X8eaeeqk4BPrc1YsY2LyRJLiBGlkpCvWBE6gZBbRDjWCIBBvZJOib0Edy-H7OZlmTNCzM6b/pub?gid=2114287982&single=true&output=csv';

        // 解析 CSV 的輔助函式
        function parseCSV(csvText) {
            const lines = csvText.split('\n').filter(line => line.trim() !== '');
            if (lines.length === 0) return [];
            
            // 解析標題列
            const headerLine = lines[0].trim();
            const headers = headerLine.match(/(".*?"|[^",\r\n]+)(?=\s*,|\s*$)/g).map(header => header.trim().replace(/^"|"$/g, ''));
            
            const result = [];
            for (let i = 1; i < lines.length; i++) {
                const dataLine = lines[i].trim();
                if (!dataLine) continue;
                const values = dataLine.match(/(".*?"|[^",\r\n]+)(?=\s*,|\s*$)/g);
                if (!values) continue;

                const item = {};
                headers.forEach((header, index) => {
                    let value = values[index] ? values[index].trim() : '';
                    value = value.replace(/^"|"$/g, ''); // 移除引號
                    
                    if (header.toLowerCase() === 'tags') {
                        item[header] = value ? value.split(',').map(tag => tag.trim()) : [];
                    } else if (header.toLowerCase() === 'id') {
                        item[header] = parseInt(value, 10);
                    } else {
                        item[header] = value;
                    }
                });
                result.push(item);
            }
            return result;
        }

        const StarGuide = () => {
            const [searchTerm, setSearchTerm] = useState('');
            const [activeCategory, setActiveCategory] = useState('全部');
            const [isMenuOpen, setIsMenuOpen] = useState(false);
            const [scrolled, setScrolled] = useState(false);
            const [fetchedResources, setFetchedResources] = useState([]); 
            const [isLoading, setIsLoading] = useState(true);
            const [error, setError] = useState(null);

            useEffect(() => {
                const handleScroll = () => setScrolled(window.scrollY > 20);
                window.addEventListener('scroll', handleScroll);
                return () => window.removeEventListener('scroll', handleScroll);
            }, []);

            useEffect(() => {
                const loadData = async () => {
                    setIsLoading(true);
                    setError(null);
                    try {
                        const response = await fetch(dataUrl);
                        if (!response.ok) throw new Error(`HTTP 錯誤! 狀態碼: ${response.status}`);
                        const csvText = await response.text();
                        const parsedData = parseCSV(csvText);
                        
                        const finalData = parsedData.map((item, index) => ({
                            ...item,
                            id: index + 1,
                            tags: Array.isArray(item.tags) ? item.tags : (item.tags ? String(item.tags).split(',').map(t => t.trim()) : []),
                        })).filter(item => item.title);
                        
                        setFetchedResources(finalData);
                    } catch (err) {
                        console.error("資料載入失敗:", err);
                        setError("無法載入資源資料，請檢查網路或 Google Sheet 連結。");
                    } finally {
                        setIsLoading(false);
                    }
                };
                loadData();
            }, []); 

            const categories = [
                '全部', '自閉症', '亞斯伯格', '發展遲緩', '學習障礙', '智能障礙', 
                '情緒行為障礙', 'ADHD/ADD', '妥瑞氏症', '身障', '資賦優異', 
                '早療時機', '評估流程', '特殊兒教育教養書', '特殊兒教育教養繪本', 
                '陪伴特殊兒Podcast', '特殊兒下載資源'
            ];

            const filteredResources = fetchedResources
                .filter(r => activeCategory === '全部' || r.category === activeCategory)
                .filter(r => 
                    (r.title && r.title.toLowerCase().includes(searchTerm.toLowerCase())) || 
                    (r.description && r.description.toLowerCase().includes(searchTerm.toLowerCase())) ||
                    (r.tags && r.tags.some(tag => tag.toLowerCase().includes(searchTerm.toLowerCase())))
                );

            return (
                <div className="min-h-screen text-slate-300 font-sans selection:bg-blue-500 selection:text-white">
                    {/* Navigation Bar */}
                    <nav className={`fixed w-full z-50 transition-all duration-300 border-b ${scrolled ? 'bg-[#020617]/90 backdrop-blur-md border-slate-800 py-3' : 'bg-transparent border-transparent py-5'}`}>
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center">
                            <div className="flex items-center gap-3">
                                <div className="flex flex-col">
                                    <div className="text-2xl font-bold text-white tracking-wider flex items-center gap-2">
                                        <span className="bg-clip-text text-transparent bg-gradient-to-r from-white to-slate-400">親子天下</span>
                                        <span className="text-xs px-1.5 py-0.5 rounded bg-gradient-to-r from-amber-500 to-yellow-600 text-white font-serif italic">Premium</span>
                                    </div>
                                    <span className="text-[10px] text-blue-400 tracking-[0.2em] uppercase">Special Needs Integration</span>
                                </div>
                            </div>
                            <div className="hidden md:flex items-center gap-8">
                                <a href="#" className="text-sm hover:text-blue-400 transition-colors">看文章</a>
                                <a href="#" className="text-sm hover:text-blue-400 transition-colors">聽podcast</a>
                                <a href="#" className="text-sm hover:text-blue-400 transition-colors">下載資源</a>
                                <div className="h-4 w-px bg-slate-700"></div>
                                <button className="flex items-center gap-2 text-sm text-white hover:text-blue-400 transition-colors">
                                    <User size={18} /><span>會員登入</span>
                                </button>
                                <a href="https://premium.parenting.com.tw/info/more-757" target="_blank" rel="noopener noreferrer" className="bg-blue-600 hover:bg-blue-500 text-white text-sm px-5 py-2 rounded-full transition-all shadow-[0_0_15px_rgba(37,99,235,0.3)]">成為會員</a>
                            </div>
                            <button className="md:hidden text-white" onClick={() => setIsMenuOpen(!isMenuOpen)}>
                                {isMenuOpen ? <X /> : <Menu />}
                            </button>
                        </div>
                    </nav>

                    {/* Mobile Menu */}
                    {isMenuOpen && (
                        <div className="fixed inset-0 z-40 bg-[#020617] pt-24 px-6 md:hidden">
                            <div className="flex flex-col gap-6 text-lg">
                                <a href="#" className="text-white border-b border-slate-800 pb-2">看文章</a>
                                <a href="#" className="text-white border-b border-slate-800 pb-2">聽podcast</a>
                                <a href="#" className="text-white border-b border-slate-800 pb-2">下載資源</a>
                            </div>
                        </div>
                    )}

                    {/* Hero Section */}
                    <div className="relative pt-32 pb-20 px-4 sm:px-6 lg:px-8 overflow-hidden">
                        <div className="absolute top-20 left-1/2 -translate-x-1/2 w-[600px] h-[600px] bg-blue-600/10 rounded-full blur-[120px] pointer-events-none"></div>
                        <div className="relative max-w-4xl mx-auto text-center z-10">
                            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-blue-900/30 border border-blue-500/30 text-blue-300 text-xs font-medium mb-6">
                                <span className="w-2 h-2 rounded-full bg-blue-400 animate-pulse"></span>
                                特殊兒資料庫大數據已更新 v2.5
                            </div>
                            <h1 className="text-4xl md:text-6xl font-bold text-white mb-6 tracking-tight leading-tight">
                                數據引路，看見孩子的<br /><span className="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-indigo-400 to-purple-400">獨特光譜</span>
                            </h1>
                            <p className="text-slate-400 text-lg mb-10 max-w-2xl mx-auto">匯集全台 500+ 醫療院所、千篇專家實證文章。</p>
                            
                            <div className="relative max-w-2xl mx-auto group">
                                <div className="absolute -inset-0.5 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-xl opacity-50 blur group-hover:opacity-75 transition duration-500"></div>
                                <div className="relative bg-[#0F172A] rounded-xl p-2 flex items-center shadow-2xl">
                                    <Search className="text-blue-400 ml-4 w-6 h-6 flex-shrink-0" />
                                    <input type="text" placeholder="搜尋症狀、資源名稱..." className="w-full bg-transparent border-none focus:ring-0 text-white placeholder-slate-500 text-lg px-4 py-2 outline-none" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} />
                                    <button className="bg-blue-600 hover:bg-blue-500 text-white px-6 py-3 rounded-lg font-medium transition-colors whitespace-nowrap">搜尋</button>
                                </div>
                                <div className="flex flex-wrap justify-center gap-2 mt-4">
                                    <span className="text-xs text-slate-500 py-1">熱門關鍵字：</span>
                                    {['早期療育', 'ADHD 評估', '語言治療', '身心障礙手冊'].map((tag) => (
                                        <button key={tag} onClick={() => setSearchTerm(tag)} className="text-xs bg-slate-800/50 hover:bg-blue-900/30 text-slate-400 hover:text-blue-300 border border-slate-700 hover:border-blue-500/50 px-3 py-1 rounded-full transition-all">#{tag}</button>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Stats */}
                    <div className="border-y border-slate-800 bg-[#0B1120]/50 backdrop-blur-sm">
                        <div className="max-w-7xl mx-auto px-4 py-8 grid grid-cols-2 md:grid-cols-4 gap-8 text-center">
                            <div className="flex flex-col items-center gap-2"><Activity className="text-blue-500 w-6 h-6" /><span className="text-2xl font-bold text-white">1,205</span><span className="text-xs text-slate-500">合作醫療機構</span></div>
                            <div className="flex flex-col items-center gap-2"><BookOpen className="text-indigo-500 w-6 h-6" /><span className="text-2xl font-bold text-white">850+</span><span className="text-xs text-slate-500">深度專題報告</span></div>
                            <div className="flex flex-col items-center gap-2"><Shield className="text-amber-500 w-6 h-6" /><span className="text-2xl font-bold text-white">50+</span><span className="text-xs text-slate-500">認證專家駐站</span></div>
                            <div className="flex flex-col items-center gap-2"><User className="text-emerald-500 w-6 h-6" /><span className="text-2xl font-bold text-white">12萬</span><span className="text-xs text-slate-500">特殊兒家庭會員</span></div>
                        </div>
                    </div>

                    {/* Content */}
                    <div className="max-w-7xl mx-auto px-4 py-16 sm:px-6 lg:px-8">
                        <div className="mb-8 relative group">
                            <div className="flex overflow-x-auto pb-4 gap-2 scrollbar-hide mask-linear-fade">
                                {categories.map((cat) => (
                                    <button key={cat} onClick={() => setActiveCategory(cat)} className={`whitespace-nowrap px-5 py-2 rounded-lg text-sm font-medium transition-all flex-shrink-0 ${activeCategory === cat ? 'bg-blue-600 text-white shadow-[0_0_15px_rgba(37,99,235,0.4)]' : 'bg-slate-800/50 text-slate-400 hover:bg-slate-800 hover:text-white'}`}>{cat}</button>
                                ))}
                            </div>
                        </div>

                        {isLoading ? (
                            <div className="col-span-full text-center py-20">
                                <div className="inline-block w-8 h-8 border-4 border-t-4 border-blue-500 border-t-transparent rounded-full mb-4 animate-[spin_1s_linear_infinite]"></div>
                                <h3 className="text-xl text-slate-300">正在載入資源...</h3>
                            </div>
                        ) : error ? (
                            <div className="col-span-full text-center py-20 text-red-400">
                                <X className="w-8 h-8 mx-auto mb-4" />
                                <h3 className="text-xl mb-2">資料載入錯誤</h3>
                                <p className="text-slate-500">{error}</p>
                            </div>
                        ) : (
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                {filteredResources.length > 0 ? (
                                    filteredResources.map((item) => (
                                        <div key={item.id} className={`group relative rounded-xl p-6 transition-all duration-300 border ${item.type === 'premium' ? 'bg-gradient-to-br from-[#0F172A] to-[#1E293B] border-slate-700 hover:border-amber-500/50' : 'bg-[#0F172A] border-slate-800 hover:border-blue-500/50'}`}>
                                            {item.type === 'premium' && (
                                                <div className="absolute top-4 right-4 bg-amber-500/10 border border-amber-500/30 text-amber-400 text-xs px-2 py-1 rounded flex items-center gap-1"><Lock size={12} /><span>Premium</span></div>
                                            )}
                                            <div className="mb-4"><span className={`text-xs font-semibold px-2 py-1 rounded ${item.type === 'premium' ? 'text-amber-400 bg-amber-900/20' : 'text-blue-400 bg-blue-900/20'}`}>{item.category}</span></div>
                                            <h3 className="text-xl font-bold text-white mb-3 line-clamp-2 group-hover:text-blue-300 transition-colors">{item.title || '無標題'}</h3>
                                            <p className="text-slate-400 text-sm mb-6 line-clamp-3 leading-relaxed">{item.description || '無摘要資訊'}</p>
                                            <div className="flex items-center justify-between text-xs text-slate-500 border-t border-slate-700/50 pt-4">
                                                <div className="flex gap-2 flex-wrap">{(item.tags || []).slice(0, 2).map(tag => <span key={tag}>#{tag}</span>)}</div>
                                                {String(item.category).includes('Podcast') ? <div className="flex items-center gap-1 text-blue-400"><Headphones size={14} /><span>收聽</span></div> :
                                                 String(item.category).includes('下載') ? <div className="flex items-center gap-1 text-blue-400"><Download size={14} /><span>資源</span></div> :
                                                 item.distance ? <div className="flex items-center gap-1"><MapPin size={14} /><span>{item.distance}</span></div> :
                                                 <div className="flex items-center gap-1 text-slate-400"><Star size={14} /><span>{item.author}</span></div>}
                                            </div>
                                            <div className="absolute bottom-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity duration-300 translate-x-2 group-hover:translate-x-0">
                                                <div className={`p-2 rounded-full ${item.type === 'premium' ? 'bg-amber-500 text-black' : 'bg-blue-600 text-white'}`}><ChevronRight size={16} /></div>
                                            </div>
                                        </div>
                                    ))
                                ) : (
                                    <div className="col-span-full text-center py-20">
                                        <div className="inline-block p-4 rounded-full bg-slate-800/50 mb-4"><Search className="text-slate-600 w-8 h-8" /></div>
                                        <h3 className="text-xl text-slate-300">無符合結果</h3>
                                    </div>
                                )}
                            </div>
                        )}
                        <div className="mt-16 text-center">
                            <button className="px-8 py-3 rounded border border-slate-700 text-slate-400 hover:text-white hover:border-slate-500 transition-all text-sm tracking-widest uppercase">載入更多資源</button>
                        </div>
                    </div>

                    <footer className="border-t border-slate-800 bg-[#020617] pt-16 pb-8">
                        <div className="max-w-7xl mx-auto px-4 text-center">
                            <div className="text-2xl font-bold text-white tracking-wider mb-4">親子天下 <span className="text-amber-500 font-serif italic">Premium</span></div>
                            <p className="text-slate-500 text-sm mb-8">專為特殊兒家庭打造的專業知識庫與資源搜尋引擎</p>
                            <div className="text-slate-700 text-xs">© 2025 Parenting World. All rights reserved.</div>
                        </div>
                    </footer>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<StarGuide />);
    </script>
</body>
</html>

